var AsgardeoAuth=function(e){"use strict";function t(e,t,r,n){return new(r||(r=Promise))((function(o,i){function s(e){try{u(n.next(e))}catch(e){i(e)}}function a(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}u((n=n.apply(e,t||[])).next())}))}var r;(r=e.ResponseMode||(e.ResponseMode={})).formPost="form_post",r.query="query";const n="/oauth2/authorize",o="/oidc/checksession",i="/oidc/logout",s="/oauth2/jwks",a="/oauth2/revoke",u="/oauth2/token",c="/oauth2/token/.well-known/openid-configuration",h="authorization_endpoint",d="op_config_initiated",f="{{token}}",l="{{username}}",p="{{scope}}",g="{{clientID}}",v="{{clientSecret}}";var y;(y=e.Stores||(e.Stores={})).ConfigData="config_data",y.OIDCProviderMetaData="oidc_provider_meta_data",y.SessionData="session_data",y.TemporaryData="temporary_data";const m="pkce_code_verifier",w="session_state",_="sign_out_success",S="openid";var b=function(e,t){return function(){for(var r=new Array(arguments.length),n=0;n<r.length;n++)r[n]=arguments[n];return e.apply(t,r)}},T=Object.prototype.toString;function A(e){return"[object Array]"===T.call(e)}function E(e){return void 0===e}function k(e){return null!==e&&"object"==typeof e}function P(e){if("[object Object]"!==T.call(e))return!1;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}function C(e){return"[object Function]"===T.call(e)}function R(e,t){if(null!=e)if("object"!=typeof e&&(e=[e]),A(e))for(var r=0,n=e.length;r<n;r++)t.call(null,e[r],r,e);else for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.call(null,e[o],o,e)}var D={isArray:A,isArrayBuffer:function(e){return"[object ArrayBuffer]"===T.call(e)},isBuffer:function(e){return null!==e&&!E(e)&&null!==e.constructor&&!E(e.constructor)&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)},isFormData:function(e){return"undefined"!=typeof FormData&&e instanceof FormData},isArrayBufferView:function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&e.buffer instanceof ArrayBuffer},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:k,isPlainObject:P,isUndefined:E,isDate:function(e){return"[object Date]"===T.call(e)},isFile:function(e){return"[object File]"===T.call(e)},isBlob:function(e){return"[object Blob]"===T.call(e)},isFunction:C,isStream:function(e){return k(e)&&C(e.pipe)},isURLSearchParams:function(e){return"undefined"!=typeof URLSearchParams&&e instanceof URLSearchParams},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&("undefined"!=typeof window&&"undefined"!=typeof document)},forEach:R,merge:function e(){var t={};function r(r,n){P(t[n])&&P(r)?t[n]=e(t[n],r):P(r)?t[n]=e({},r):A(r)?t[n]=r.slice():t[n]=r}for(var n=0,o=arguments.length;n<o;n++)R(arguments[n],r);return t},extend:function(e,t,r){return R(t,(function(t,n){e[n]=r&&"function"==typeof t?b(t,r):t})),e},trim:function(e){return e.replace(/^\s*/,"").replace(/\s*$/,"")},stripBOM:function(e){return 65279===e.charCodeAt(0)&&(e=e.slice(1)),e}};function O(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var U=function(e,t,r){if(!t)return e;var n;if(r)n=r(t);else if(D.isURLSearchParams(t))n=t.toString();else{var o=[];D.forEach(t,(function(e,t){null!=e&&(D.isArray(e)?t+="[]":e=[e],D.forEach(e,(function(e){D.isDate(e)?e=e.toISOString():D.isObject(e)&&(e=JSON.stringify(e)),o.push(O(t)+"="+O(e))})))})),n=o.join("&")}if(n){var i=e.indexOf("#");-1!==i&&(e=e.slice(0,i)),e+=(-1===e.indexOf("?")?"?":"&")+n}return e};function I(){this.handlers=[]}I.prototype.use=function(e,t){return this.handlers.push({fulfilled:e,rejected:t}),this.handlers.length-1},I.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},I.prototype.forEach=function(e){D.forEach(this.handlers,(function(t){null!==t&&e(t)}))};var L=I,j=function(e,t,r){return D.forEach(r,(function(r){e=r(e,t)})),e},H=function(e){return!(!e||!e.__CANCEL__)},N="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};function x(){throw new Error("setTimeout has not been defined")}function M(){throw new Error("clearTimeout has not been defined")}var B=x,K=M;function q(e){if(B===setTimeout)return setTimeout(e,0);if((B===x||!B)&&setTimeout)return B=setTimeout,setTimeout(e,0);try{return B(e,0)}catch(t){try{return B.call(null,e,0)}catch(t){return B.call(this,e,0)}}}"function"==typeof N.setTimeout&&(B=setTimeout),"function"==typeof N.clearTimeout&&(K=clearTimeout);var J,W=[],F=!1,Y=-1;function z(){F&&J&&(F=!1,J.length?W=J.concat(W):Y=-1,W.length&&$())}function $(){if(!F){var e=q(z);F=!0;for(var t=W.length;t;){for(J=W,W=[];++Y<t;)J&&J[Y].run();Y=-1,t=W.length}J=null,F=!1,function(e){if(K===clearTimeout)return clearTimeout(e);if((K===M||!K)&&clearTimeout)return K=clearTimeout,clearTimeout(e);try{K(e)}catch(t){try{return K.call(null,e)}catch(t){return K.call(this,e)}}}(e)}}function V(e,t){this.fun=e,this.array=t}V.prototype.run=function(){this.fun.apply(null,this.array)};function G(){}var X=G,Z=G,Q=G,ee=G,te=G,re=G,ne=G;var oe=N.performance||{},ie=oe.now||oe.mozNow||oe.msNow||oe.oNow||oe.webkitNow||function(){return(new Date).getTime()};var se=new Date;var ae={nextTick:function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];W.push(new V(e,t)),1!==W.length||F||q($)},title:"browser",browser:!0,env:{},argv:[],version:"",versions:{},on:X,addListener:Z,once:Q,off:ee,removeListener:te,removeAllListeners:re,emit:ne,binding:function(e){throw new Error("process.binding is not supported")},cwd:function(){return"/"},chdir:function(e){throw new Error("process.chdir is not supported")},umask:function(){return 0},hrtime:function(e){var t=.001*ie.call(oe),r=Math.floor(t),n=Math.floor(t%1*1e9);return e&&(r-=e[0],(n-=e[1])<0&&(r--,n+=1e9)),[r,n]},platform:"browser",release:{},config:{},uptime:function(){return(new Date-se)/1e3}},ue=function(e,t){D.forEach(e,(function(r,n){n!==t&&n.toUpperCase()===t.toUpperCase()&&(e[t]=r,delete e[n])}))},ce=function(e,t,r,n,o){return function(e,t,r,n,o){return e.config=t,r&&(e.code=r),e.request=n,e.response=o,e.isAxiosError=!0,e.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},e}(new Error(e),t,r,n,o)},he=D.isStandardBrowserEnv()?{write:function(e,t,r,n,o,i){var s=[];s.push(e+"="+encodeURIComponent(t)),D.isNumber(r)&&s.push("expires="+new Date(r).toGMTString()),D.isString(n)&&s.push("path="+n),D.isString(o)&&s.push("domain="+o),!0===i&&s.push("secure"),document.cookie=s.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}},de=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"],fe=D.isStandardBrowserEnv()?function(){var e,t=/(msie|trident)/i.test(navigator.userAgent),r=document.createElement("a");function n(e){var n=e;return t&&(r.setAttribute("href",n),n=r.href),r.setAttribute("href",n),{href:r.href,protocol:r.protocol?r.protocol.replace(/:$/,""):"",host:r.host,search:r.search?r.search.replace(/^\?/,""):"",hash:r.hash?r.hash.replace(/^#/,""):"",hostname:r.hostname,port:r.port,pathname:"/"===r.pathname.charAt(0)?r.pathname:"/"+r.pathname}}return e=n(window.location.href),function(t){var r=D.isString(t)?n(t):t;return r.protocol===e.protocol&&r.host===e.host}}():function(){return!0},le=function(e){return new Promise((function(t,r){var n=e.data,o=e.headers;D.isFormData(n)&&delete o["Content-Type"];var i=new XMLHttpRequest;if(e.auth){var s=e.auth.username||"",a=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";o.Authorization="Basic "+btoa(s+":"+a)}var u,c,h=(u=e.baseURL,c=e.url,u&&!/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(c)?function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}(u,c):c);if(i.open(e.method.toUpperCase(),U(h,e.params,e.paramsSerializer),!0),i.timeout=e.timeout,i.onreadystatechange=function(){if(i&&4===i.readyState&&(0!==i.status||i.responseURL&&0===i.responseURL.indexOf("file:"))){var n,o,s,a,u,c="getAllResponseHeaders"in i?(n=i.getAllResponseHeaders(),u={},n?(D.forEach(n.split("\n"),(function(e){if(a=e.indexOf(":"),o=D.trim(e.substr(0,a)).toLowerCase(),s=D.trim(e.substr(a+1)),o){if(u[o]&&de.indexOf(o)>=0)return;u[o]="set-cookie"===o?(u[o]?u[o]:[]).concat([s]):u[o]?u[o]+", "+s:s}})),u):u):null,h={data:e.responseType&&"text"!==e.responseType?i.response:i.responseText,status:i.status,statusText:i.statusText,headers:c,config:e,request:i};!function(e,t,r){var n=r.config.validateStatus;r.status&&n&&!n(r.status)?t(ce("Request failed with status code "+r.status,r.config,null,r.request,r)):e(r)}(t,r,h),i=null}},i.onabort=function(){i&&(r(ce("Request aborted",e,"ECONNABORTED",i)),i=null)},i.onerror=function(){r(ce("Network Error",e,null,i)),i=null},i.ontimeout=function(){var t="timeout of "+e.timeout+"ms exceeded";e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),r(ce(t,e,"ECONNABORTED",i)),i=null},D.isStandardBrowserEnv()){var d=(e.withCredentials||fe(h))&&e.xsrfCookieName?he.read(e.xsrfCookieName):void 0;d&&(o[e.xsrfHeaderName]=d)}if("setRequestHeader"in i&&D.forEach(o,(function(e,t){void 0===n&&"content-type"===t.toLowerCase()?delete o[t]:i.setRequestHeader(t,e)})),D.isUndefined(e.withCredentials)||(i.withCredentials=!!e.withCredentials),e.responseType)try{i.responseType=e.responseType}catch(t){if("json"!==e.responseType)throw t}"function"==typeof e.onDownloadProgress&&i.addEventListener("progress",e.onDownloadProgress),"function"==typeof e.onUploadProgress&&i.upload&&i.upload.addEventListener("progress",e.onUploadProgress),e.cancelToken&&e.cancelToken.promise.then((function(e){i&&(i.abort(),r(e),i=null)})),n||(n=null),i.send(n)}))},pe={"Content-Type":"application/x-www-form-urlencoded"};function ge(e,t){!D.isUndefined(e)&&D.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var ve,ye={adapter:(("undefined"!=typeof XMLHttpRequest||void 0!==ae&&"[object process]"===Object.prototype.toString.call(ae))&&(ve=le),ve),transformRequest:[function(e,t){return ue(t,"Accept"),ue(t,"Content-Type"),D.isFormData(e)||D.isArrayBuffer(e)||D.isBuffer(e)||D.isStream(e)||D.isFile(e)||D.isBlob(e)?e:D.isArrayBufferView(e)?e.buffer:D.isURLSearchParams(e)?(ge(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):D.isObject(e)?(ge(t,"application/json;charset=utf-8"),JSON.stringify(e)):e}],transformResponse:[function(e){if("string"==typeof e)try{e=JSON.parse(e)}catch(e){}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(e){return e>=200&&e<300}};ye.headers={common:{Accept:"application/json, text/plain, */*"}},D.forEach(["delete","get","head"],(function(e){ye.headers[e]={}})),D.forEach(["post","put","patch"],(function(e){ye.headers[e]=D.merge(pe)}));var me=ye;function we(e){e.cancelToken&&e.cancelToken.throwIfRequested()}var _e=function(e){return we(e),e.headers=e.headers||{},e.data=j(e.data,e.headers,e.transformRequest),e.headers=D.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),D.forEach(["delete","get","head","post","put","patch","common"],(function(t){delete e.headers[t]})),(e.adapter||me.adapter)(e).then((function(t){return we(e),t.data=j(t.data,t.headers,e.transformResponse),t}),(function(t){return H(t)||(we(e),t&&t.response&&(t.response.data=j(t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)}))},Se=function(e,t){t=t||{};var r={},n=["url","method","data"],o=["headers","auth","proxy","params"],i=["baseURL","transformRequest","transformResponse","paramsSerializer","timeout","timeoutMessage","withCredentials","adapter","responseType","xsrfCookieName","xsrfHeaderName","onUploadProgress","onDownloadProgress","decompress","maxContentLength","maxBodyLength","maxRedirects","transport","httpAgent","httpsAgent","cancelToken","socketPath","responseEncoding"],s=["validateStatus"];function a(e,t){return D.isPlainObject(e)&&D.isPlainObject(t)?D.merge(e,t):D.isPlainObject(t)?D.merge({},t):D.isArray(t)?t.slice():t}function u(n){D.isUndefined(t[n])?D.isUndefined(e[n])||(r[n]=a(void 0,e[n])):r[n]=a(e[n],t[n])}D.forEach(n,(function(e){D.isUndefined(t[e])||(r[e]=a(void 0,t[e]))})),D.forEach(o,u),D.forEach(i,(function(n){D.isUndefined(t[n])?D.isUndefined(e[n])||(r[n]=a(void 0,e[n])):r[n]=a(void 0,t[n])})),D.forEach(s,(function(n){n in t?r[n]=a(e[n],t[n]):n in e&&(r[n]=a(void 0,e[n]))}));var c=n.concat(o).concat(i).concat(s),h=Object.keys(e).concat(Object.keys(t)).filter((function(e){return-1===c.indexOf(e)}));return D.forEach(h,u),r};function be(e){this.defaults=e,this.interceptors={request:new L,response:new L}}be.prototype.request=function(e){"string"==typeof e?(e=arguments[1]||{}).url=arguments[0]:e=e||{},(e=Se(this.defaults,e)).method?e.method=e.method.toLowerCase():this.defaults.method?e.method=this.defaults.method.toLowerCase():e.method="get";var t=[_e,void 0],r=Promise.resolve(e);for(this.interceptors.request.forEach((function(e){t.unshift(e.fulfilled,e.rejected)})),this.interceptors.response.forEach((function(e){t.push(e.fulfilled,e.rejected)}));t.length;)r=r.then(t.shift(),t.shift());return r},be.prototype.getUri=function(e){return e=Se(this.defaults,e),U(e.url,e.params,e.paramsSerializer).replace(/^\?/,"")},D.forEach(["delete","get","head","options"],(function(e){be.prototype[e]=function(t,r){return this.request(Se(r||{},{method:e,url:t,data:(r||{}).data}))}})),D.forEach(["post","put","patch"],(function(e){be.prototype[e]=function(t,r,n){return this.request(Se(n||{},{method:e,url:t,data:r}))}}));var Te=be;function Ae(e){this.message=e}Ae.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},Ae.prototype.__CANCEL__=!0;var Ee=Ae;function ke(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise((function(e){t=e}));var r=this;e((function(e){r.reason||(r.reason=new Ee(e),t(r.reason))}))}ke.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},ke.source=function(){var e;return{token:new ke((function(t){e=t})),cancel:e}};var Pe=ke;function Ce(e){var t=new Te(e),r=b(Te.prototype.request,t);return D.extend(r,Te.prototype,t),D.extend(r,t),r}var Re=Ce(me);Re.Axios=Te,Re.create=function(e){return Ce(Se(Re.defaults,e))},Re.Cancel=Ee,Re.CancelToken=Pe,Re.isCancel=H,Re.all=function(e){return Promise.all(e)},Re.spread=function(e){return function(t){return e.apply(null,t)}};var De=Re,Oe=Re;De.default=Oe;var Ue=De;class Ie extends Error{constructor(e,t,r,n,o,i){super(null!=n?n:null==i?void 0:i.message),this.name=this.constructor.name,this.code=e,this.file=t,this.method=r,this.description=o,this.error=i,Object.setPrototypeOf(this,new.target.prototype)}}class Le extends Ie{constructor(e,t,r,n,o,i,s,a,u){super(e,t,r,n,o),this.name=this.constructor.name,this.code=e,this.file=t,this.method=r,this.description=o,this.networkErrorCode=i,this.networkErrorMessage=s,this.status=a,this.networkErrorData=u}}var je="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function He(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function Ne(e,t,r){return e(r={path:t,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&r.path)}},r.exports),r.exports}function xe(e){if(e.__esModule)return e;var t=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(e).forEach((function(r){var n=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,n.get?n:{enumerable:!0,get:function(){return e[r]}})})),t}var Me=[],Be=[],Ke="undefined"!=typeof Uint8Array?Uint8Array:Array,qe=!1;function Je(){qe=!0;for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t=0,r=e.length;t<r;++t)Me[t]=e[t],Be[e.charCodeAt(t)]=t;Be["-".charCodeAt(0)]=62,Be["_".charCodeAt(0)]=63}function We(e,t,r){for(var n,o,i=[],s=t;s<r;s+=3)n=(e[s]<<16)+(e[s+1]<<8)+e[s+2],i.push(Me[(o=n)>>18&63]+Me[o>>12&63]+Me[o>>6&63]+Me[63&o]);return i.join("")}function Fe(e){var t;qe||Je();for(var r=e.length,n=r%3,o="",i=[],s=16383,a=0,u=r-n;a<u;a+=s)i.push(We(e,a,a+s>u?u:a+s));return 1===n?(t=e[r-1],o+=Me[t>>2],o+=Me[t<<4&63],o+="=="):2===n&&(t=(e[r-2]<<8)+e[r-1],o+=Me[t>>10],o+=Me[t>>4&63],o+=Me[t<<2&63],o+="="),i.push(o),i.join("")}function Ye(e,t,r,n,o){var i,s,a=8*o-n-1,u=(1<<a)-1,c=u>>1,h=-7,d=r?o-1:0,f=r?-1:1,l=e[t+d];for(d+=f,i=l&(1<<-h)-1,l>>=-h,h+=a;h>0;i=256*i+e[t+d],d+=f,h-=8);for(s=i&(1<<-h)-1,i>>=-h,h+=n;h>0;s=256*s+e[t+d],d+=f,h-=8);if(0===i)i=1-c;else{if(i===u)return s?NaN:1/0*(l?-1:1);s+=Math.pow(2,n),i-=c}return(l?-1:1)*s*Math.pow(2,i-n)}function ze(e,t,r,n,o,i){var s,a,u,c=8*i-o-1,h=(1<<c)-1,d=h>>1,f=23===o?Math.pow(2,-24)-Math.pow(2,-77):0,l=n?0:i-1,p=n?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=h):(s=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-s))<1&&(s--,u*=2),(t+=s+d>=1?f/u:f*Math.pow(2,1-d))*u>=2&&(s++,u/=2),s+d>=h?(a=0,s=h):s+d>=1?(a=(t*u-1)*Math.pow(2,o),s+=d):(a=t*Math.pow(2,d-1)*Math.pow(2,o),s=0));o>=8;e[r+l]=255&a,l+=p,a/=256,o-=8);for(s=s<<o|a,c+=o;c>0;e[r+l]=255&s,l+=p,s/=256,c-=8);e[r+l-p]|=128*g}var $e={}.toString,Ve=Array.isArray||function(e){return"[object Array]"==$e.call(e)};Qe.TYPED_ARRAY_SUPPORT=void 0===N.TYPED_ARRAY_SUPPORT||N.TYPED_ARRAY_SUPPORT;var Ge=Xe();function Xe(){return Qe.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function Ze(e,t){if(Xe()<t)throw new RangeError("Invalid typed array length");return Qe.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=Qe.prototype:(null===e&&(e=new Qe(t)),e.length=t),e}function Qe(e,t,r){if(!(Qe.TYPED_ARRAY_SUPPORT||this instanceof Qe))return new Qe(e,t,r);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return rt(this,e)}return et(this,e,t,r)}function et(e,t,r,n){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,r,n){if(t.byteLength,r<0||t.byteLength<r)throw new RangeError("'offset' is out of bounds");if(t.byteLength<r+(n||0))throw new RangeError("'length' is out of bounds");t=void 0===r&&void 0===n?new Uint8Array(t):void 0===n?new Uint8Array(t,r):new Uint8Array(t,r,n);Qe.TYPED_ARRAY_SUPPORT?(e=t).__proto__=Qe.prototype:e=nt(e,t);return e}(e,t,r,n):"string"==typeof t?function(e,t,r){"string"==typeof r&&""!==r||(r="utf8");if(!Qe.isEncoding(r))throw new TypeError('"encoding" must be a valid string encoding');var n=0|st(t,r),o=(e=Ze(e,n)).write(t,r);o!==n&&(e=e.slice(0,o));return e}(e,t,r):function(e,t){if(it(t)){var r=0|ot(t.length);return 0===(e=Ze(e,r)).length||t.copy(e,0,0,r),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(n=t.length)!=n?Ze(e,0):nt(e,t);if("Buffer"===t.type&&Ve(t.data))return nt(e,t.data)}var n;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function tt(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function rt(e,t){if(tt(t),e=Ze(e,t<0?0:0|ot(t)),!Qe.TYPED_ARRAY_SUPPORT)for(var r=0;r<t;++r)e[r]=0;return e}function nt(e,t){var r=t.length<0?0:0|ot(t.length);e=Ze(e,r);for(var n=0;n<r;n+=1)e[n]=255&t[n];return e}function ot(e){if(e>=Xe())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+Xe().toString(16)+" bytes");return 0|e}function it(e){return!(null==e||!e._isBuffer)}function st(e,t){if(it(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var r=e.length;if(0===r)return 0;for(var n=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return It(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return Lt(e).length;default:if(n)return It(e).length;t=(""+t).toLowerCase(),n=!0}}function at(e,t,r){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return bt(this,t,r);case"utf8":case"utf-8":return mt(this,t,r);case"ascii":return _t(this,t,r);case"latin1":case"binary":return St(this,t,r);case"base64":return yt(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Tt(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function ut(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function ct(e,t,r,n,o){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=o?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(o)return-1;r=e.length-1}else if(r<0){if(!o)return-1;r=0}if("string"==typeof t&&(t=Qe.from(t,n)),it(t))return 0===t.length?-1:ht(e,t,r,n,o);if("number"==typeof t)return t&=255,Qe.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?o?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):ht(e,[t],r,n,o);throw new TypeError("val must be string, number or Buffer")}function ht(e,t,r,n,o){var i,s=1,a=e.length,u=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;s=2,a/=2,u/=2,r/=2}function c(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(o){var h=-1;for(i=r;i<a;i++)if(c(e,i)===c(t,-1===h?0:i-h)){if(-1===h&&(h=i),i-h+1===u)return h*s}else-1!==h&&(i-=i-h),h=-1}else for(r+u>a&&(r=a-u),i=r;i>=0;i--){for(var d=!0,f=0;f<u;f++)if(c(e,i+f)!==c(t,f)){d=!1;break}if(d)return i}return-1}function dt(e,t,r,n){r=Number(r)||0;var o=e.length-r;n?(n=Number(n))>o&&(n=o):n=o;var i=t.length;if(i%2!=0)throw new TypeError("Invalid hex string");n>i/2&&(n=i/2);for(var s=0;s<n;++s){var a=parseInt(t.substr(2*s,2),16);if(isNaN(a))return s;e[r+s]=a}return s}function ft(e,t,r,n){return jt(It(t,e.length-r),e,r,n)}function lt(e,t,r,n){return jt(function(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function pt(e,t,r,n){return lt(e,t,r,n)}function gt(e,t,r,n){return jt(Lt(t),e,r,n)}function vt(e,t,r,n){return jt(function(e,t){for(var r,n,o,i=[],s=0;s<e.length&&!((t-=2)<0);++s)n=(r=e.charCodeAt(s))>>8,o=r%256,i.push(o),i.push(n);return i}(t,e.length-r),e,r,n)}function yt(e,t,r){return 0===t&&r===e.length?Fe(e):Fe(e.slice(t,r))}function mt(e,t,r){r=Math.min(e.length,r);for(var n=[],o=t;o<r;){var i,s,a,u,c=e[o],h=null,d=c>239?4:c>223?3:c>191?2:1;if(o+d<=r)switch(d){case 1:c<128&&(h=c);break;case 2:128==(192&(i=e[o+1]))&&(u=(31&c)<<6|63&i)>127&&(h=u);break;case 3:i=e[o+1],s=e[o+2],128==(192&i)&&128==(192&s)&&(u=(15&c)<<12|(63&i)<<6|63&s)>2047&&(u<55296||u>57343)&&(h=u);break;case 4:i=e[o+1],s=e[o+2],a=e[o+3],128==(192&i)&&128==(192&s)&&128==(192&a)&&(u=(15&c)<<18|(63&i)<<12|(63&s)<<6|63&a)>65535&&u<1114112&&(h=u)}null===h?(h=65533,d=1):h>65535&&(h-=65536,n.push(h>>>10&1023|55296),h=56320|1023&h),n.push(h),o+=d}return function(e){var t=e.length;if(t<=wt)return String.fromCharCode.apply(String,e);var r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=wt));return r}(n)}Qe.poolSize=8192,Qe._augment=function(e){return e.__proto__=Qe.prototype,e},Qe.from=function(e,t,r){return et(null,e,t,r)},Qe.TYPED_ARRAY_SUPPORT&&(Qe.prototype.__proto__=Uint8Array.prototype,Qe.__proto__=Uint8Array),Qe.alloc=function(e,t,r){return function(e,t,r,n){return tt(t),t<=0?Ze(e,t):void 0!==r?"string"==typeof n?Ze(e,t).fill(r,n):Ze(e,t).fill(r):Ze(e,t)}(null,e,t,r)},Qe.allocUnsafe=function(e){return rt(null,e)},Qe.allocUnsafeSlow=function(e){return rt(null,e)},Qe.isBuffer=Ht,Qe.compare=function(e,t){if(!it(e)||!it(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var r=e.length,n=t.length,o=0,i=Math.min(r,n);o<i;++o)if(e[o]!==t[o]){r=e[o],n=t[o];break}return r<n?-1:n<r?1:0},Qe.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Qe.concat=function(e,t){if(!Ve(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return Qe.alloc(0);var r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;var n=Qe.allocUnsafe(t),o=0;for(r=0;r<e.length;++r){var i=e[r];if(!it(i))throw new TypeError('"list" argument must be an Array of Buffers');i.copy(n,o),o+=i.length}return n},Qe.byteLength=st,Qe.prototype._isBuffer=!0,Qe.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)ut(this,t,t+1);return this},Qe.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)ut(this,t,t+3),ut(this,t+1,t+2);return this},Qe.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)ut(this,t,t+7),ut(this,t+1,t+6),ut(this,t+2,t+5),ut(this,t+3,t+4);return this},Qe.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?mt(this,0,e):at.apply(this,arguments)},Qe.prototype.equals=function(e){if(!it(e))throw new TypeError("Argument must be a Buffer");return this===e||0===Qe.compare(this,e)},Qe.prototype.inspect=function(){var e="";return this.length>0&&(e=this.toString("hex",0,50).match(/.{2}/g).join(" "),this.length>50&&(e+=" ... ")),"<Buffer "+e+">"},Qe.prototype.compare=function(e,t,r,n,o){if(!it(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===o&&(o=this.length),t<0||r>e.length||n<0||o>this.length)throw new RangeError("out of range index");if(n>=o&&t>=r)return 0;if(n>=o)return-1;if(t>=r)return 1;if(this===e)return 0;for(var i=(o>>>=0)-(n>>>=0),s=(r>>>=0)-(t>>>=0),a=Math.min(i,s),u=this.slice(n,o),c=e.slice(t,r),h=0;h<a;++h)if(u[h]!==c[h]){i=u[h],s=c[h];break}return i<s?-1:s<i?1:0},Qe.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},Qe.prototype.indexOf=function(e,t,r){return ct(this,e,t,r,!0)},Qe.prototype.lastIndexOf=function(e,t,r){return ct(this,e,t,r,!1)},Qe.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(r)?(r|=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var o=this.length-t;if((void 0===r||r>o)&&(r=o),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var i=!1;;)switch(n){case"hex":return dt(this,e,t,r);case"utf8":case"utf-8":return ft(this,e,t,r);case"ascii":return lt(this,e,t,r);case"latin1":case"binary":return pt(this,e,t,r);case"base64":return gt(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return vt(this,e,t,r);default:if(i)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),i=!0}},Qe.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var wt=4096;function _t(e,t,r){var n="";r=Math.min(e.length,r);for(var o=t;o<r;++o)n+=String.fromCharCode(127&e[o]);return n}function St(e,t,r){var n="";r=Math.min(e.length,r);for(var o=t;o<r;++o)n+=String.fromCharCode(e[o]);return n}function bt(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var o="",i=t;i<r;++i)o+=Ut(e[i]);return o}function Tt(e,t,r){for(var n=e.slice(t,r),o="",i=0;i<n.length;i+=2)o+=String.fromCharCode(n[i]+256*n[i+1]);return o}function At(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function Et(e,t,r,n,o,i){if(!it(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>o||t<i)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function kt(e,t,r,n){t<0&&(t=65535+t+1);for(var o=0,i=Math.min(e.length-r,2);o<i;++o)e[r+o]=(t&255<<8*(n?o:1-o))>>>8*(n?o:1-o)}function Pt(e,t,r,n){t<0&&(t=4294967295+t+1);for(var o=0,i=Math.min(e.length-r,4);o<i;++o)e[r+o]=t>>>8*(n?o:3-o)&255}function Ct(e,t,r,n,o,i){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function Rt(e,t,r,n,o){return o||Ct(e,0,r,4),ze(e,t,r,n,23,4),r+4}function Dt(e,t,r,n,o){return o||Ct(e,0,r,8),ze(e,t,r,n,52,8),r+8}Qe.prototype.slice=function(e,t){var r,n=this.length;if((e=~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),(t=void 0===t?n:~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e),Qe.TYPED_ARRAY_SUPPORT)(r=this.subarray(e,t)).__proto__=Qe.prototype;else{var o=t-e;r=new Qe(o,void 0);for(var i=0;i<o;++i)r[i]=this[i+e]}return r},Qe.prototype.readUIntLE=function(e,t,r){e|=0,t|=0,r||At(e,t,this.length);for(var n=this[e],o=1,i=0;++i<t&&(o*=256);)n+=this[e+i]*o;return n},Qe.prototype.readUIntBE=function(e,t,r){e|=0,t|=0,r||At(e,t,this.length);for(var n=this[e+--t],o=1;t>0&&(o*=256);)n+=this[e+--t]*o;return n},Qe.prototype.readUInt8=function(e,t){return t||At(e,1,this.length),this[e]},Qe.prototype.readUInt16LE=function(e,t){return t||At(e,2,this.length),this[e]|this[e+1]<<8},Qe.prototype.readUInt16BE=function(e,t){return t||At(e,2,this.length),this[e]<<8|this[e+1]},Qe.prototype.readUInt32LE=function(e,t){return t||At(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},Qe.prototype.readUInt32BE=function(e,t){return t||At(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},Qe.prototype.readIntLE=function(e,t,r){e|=0,t|=0,r||At(e,t,this.length);for(var n=this[e],o=1,i=0;++i<t&&(o*=256);)n+=this[e+i]*o;return n>=(o*=128)&&(n-=Math.pow(2,8*t)),n},Qe.prototype.readIntBE=function(e,t,r){e|=0,t|=0,r||At(e,t,this.length);for(var n=t,o=1,i=this[e+--n];n>0&&(o*=256);)i+=this[e+--n]*o;return i>=(o*=128)&&(i-=Math.pow(2,8*t)),i},Qe.prototype.readInt8=function(e,t){return t||At(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},Qe.prototype.readInt16LE=function(e,t){t||At(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},Qe.prototype.readInt16BE=function(e,t){t||At(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},Qe.prototype.readInt32LE=function(e,t){return t||At(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},Qe.prototype.readInt32BE=function(e,t){return t||At(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},Qe.prototype.readFloatLE=function(e,t){return t||At(e,4,this.length),Ye(this,e,!0,23,4)},Qe.prototype.readFloatBE=function(e,t){return t||At(e,4,this.length),Ye(this,e,!1,23,4)},Qe.prototype.readDoubleLE=function(e,t){return t||At(e,8,this.length),Ye(this,e,!0,52,8)},Qe.prototype.readDoubleBE=function(e,t){return t||At(e,8,this.length),Ye(this,e,!1,52,8)},Qe.prototype.writeUIntLE=function(e,t,r,n){(e=+e,t|=0,r|=0,n)||Et(this,e,t,r,Math.pow(2,8*r)-1,0);var o=1,i=0;for(this[t]=255&e;++i<r&&(o*=256);)this[t+i]=e/o&255;return t+r},Qe.prototype.writeUIntBE=function(e,t,r,n){(e=+e,t|=0,r|=0,n)||Et(this,e,t,r,Math.pow(2,8*r)-1,0);var o=r-1,i=1;for(this[t+o]=255&e;--o>=0&&(i*=256);)this[t+o]=e/i&255;return t+r},Qe.prototype.writeUInt8=function(e,t,r){return e=+e,t|=0,r||Et(this,e,t,1,255,0),Qe.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},Qe.prototype.writeUInt16LE=function(e,t,r){return e=+e,t|=0,r||Et(this,e,t,2,65535,0),Qe.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):kt(this,e,t,!0),t+2},Qe.prototype.writeUInt16BE=function(e,t,r){return e=+e,t|=0,r||Et(this,e,t,2,65535,0),Qe.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):kt(this,e,t,!1),t+2},Qe.prototype.writeUInt32LE=function(e,t,r){return e=+e,t|=0,r||Et(this,e,t,4,4294967295,0),Qe.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):Pt(this,e,t,!0),t+4},Qe.prototype.writeUInt32BE=function(e,t,r){return e=+e,t|=0,r||Et(this,e,t,4,4294967295,0),Qe.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):Pt(this,e,t,!1),t+4},Qe.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t|=0,!n){var o=Math.pow(2,8*r-1);Et(this,e,t,r,o-1,-o)}var i=0,s=1,a=0;for(this[t]=255&e;++i<r&&(s*=256);)e<0&&0===a&&0!==this[t+i-1]&&(a=1),this[t+i]=(e/s>>0)-a&255;return t+r},Qe.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t|=0,!n){var o=Math.pow(2,8*r-1);Et(this,e,t,r,o-1,-o)}var i=r-1,s=1,a=0;for(this[t+i]=255&e;--i>=0&&(s*=256);)e<0&&0===a&&0!==this[t+i+1]&&(a=1),this[t+i]=(e/s>>0)-a&255;return t+r},Qe.prototype.writeInt8=function(e,t,r){return e=+e,t|=0,r||Et(this,e,t,1,127,-128),Qe.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},Qe.prototype.writeInt16LE=function(e,t,r){return e=+e,t|=0,r||Et(this,e,t,2,32767,-32768),Qe.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):kt(this,e,t,!0),t+2},Qe.prototype.writeInt16BE=function(e,t,r){return e=+e,t|=0,r||Et(this,e,t,2,32767,-32768),Qe.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):kt(this,e,t,!1),t+2},Qe.prototype.writeInt32LE=function(e,t,r){return e=+e,t|=0,r||Et(this,e,t,4,2147483647,-2147483648),Qe.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):Pt(this,e,t,!0),t+4},Qe.prototype.writeInt32BE=function(e,t,r){return e=+e,t|=0,r||Et(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),Qe.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):Pt(this,e,t,!1),t+4},Qe.prototype.writeFloatLE=function(e,t,r){return Rt(this,e,t,!0,r)},Qe.prototype.writeFloatBE=function(e,t,r){return Rt(this,e,t,!1,r)},Qe.prototype.writeDoubleLE=function(e,t,r){return Dt(this,e,t,!0,r)},Qe.prototype.writeDoubleBE=function(e,t,r){return Dt(this,e,t,!1,r)},Qe.prototype.copy=function(e,t,r,n){if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var o,i=n-r;if(this===e&&r<t&&t<n)for(o=i-1;o>=0;--o)e[o+t]=this[o+r];else if(i<1e3||!Qe.TYPED_ARRAY_SUPPORT)for(o=0;o<i;++o)e[o+t]=this[o+r];else Uint8Array.prototype.set.call(e,this.subarray(r,r+i),t);return i},Qe.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),1===e.length){var o=e.charCodeAt(0);o<256&&(e=o)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!Qe.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;var i;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(i=t;i<r;++i)this[i]=e;else{var s=it(e)?e:It(new Qe(e,n).toString()),a=s.length;for(i=0;i<r-t;++i)this[i+t]=s[i%a]}return this};var Ot=/[^+\/0-9A-Za-z-_]/g;function Ut(e){return e<16?"0"+e.toString(16):e.toString(16)}function It(e,t){var r;t=t||1/0;for(var n=e.length,o=null,i=[],s=0;s<n;++s){if((r=e.charCodeAt(s))>55295&&r<57344){if(!o){if(r>56319){(t-=3)>-1&&i.push(239,191,189);continue}if(s+1===n){(t-=3)>-1&&i.push(239,191,189);continue}o=r;continue}if(r<56320){(t-=3)>-1&&i.push(239,191,189),o=r;continue}r=65536+(o-55296<<10|r-56320)}else o&&(t-=3)>-1&&i.push(239,191,189);if(o=null,r<128){if((t-=1)<0)break;i.push(r)}else if(r<2048){if((t-=2)<0)break;i.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;i.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;i.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return i}function Lt(e){return function(e){var t,r,n,o,i,s;qe||Je();var a=e.length;if(a%4>0)throw new Error("Invalid string. Length must be a multiple of 4");i="="===e[a-2]?2:"="===e[a-1]?1:0,s=new Ke(3*a/4-i),n=i>0?a-4:a;var u=0;for(t=0,r=0;t<n;t+=4,r+=3)o=Be[e.charCodeAt(t)]<<18|Be[e.charCodeAt(t+1)]<<12|Be[e.charCodeAt(t+2)]<<6|Be[e.charCodeAt(t+3)],s[u++]=o>>16&255,s[u++]=o>>8&255,s[u++]=255&o;return 2===i?(o=Be[e.charCodeAt(t)]<<2|Be[e.charCodeAt(t+1)]>>4,s[u++]=255&o):1===i&&(o=Be[e.charCodeAt(t)]<<10|Be[e.charCodeAt(t+1)]<<4|Be[e.charCodeAt(t+2)]>>2,s[u++]=o>>8&255,s[u++]=255&o),s}(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(Ot,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function jt(e,t,r,n){for(var o=0;o<n&&!(o+r>=t.length||o>=e.length);++o)t[o+r]=e[o];return o}function Ht(e){return null!=e&&(!!e._isBuffer||Nt(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&Nt(e.slice(0,0))}(e))}function Nt(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}var xt=Object.freeze({__proto__:null,Buffer:Qe,INSPECT_MAX_BYTES:50,SlowBuffer:function(e){return+e!=e&&(e=0),Qe.alloc(+e)},isBuffer:Ht,kMaxLength:Ge}),Mt=Ne((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=e.length,r=t%4;if(!r)return e;var n=t,o=4-r,i=t+o,s=Qe.alloc(i);for(s.write(e);o--;)s.write("=",n++);return s.toString()}})),Bt=Ne((function(e,t){function r(e,t){return void 0===t&&(t="utf8"),Qe.isBuffer(e)?o(e.toString("base64")):o(Qe.from(e,t).toString("base64"))}function n(e){return e=e.toString(),Mt.default(e).replace(/\-/g,"+").replace(/_/g,"/")}function o(e){return e.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}Object.defineProperty(t,"__esModule",{value:!0});var i=r;i.encode=r,i.decode=function(e,t){return void 0===t&&(t="utf8"),Qe.from(n(e),"base64").toString(t)},i.toBase64=n,i.fromBase64=o,i.toBuffer=function(e){return Qe.from(n(e),"base64")},t.default=i})),Kt=Ne((function(e){e.exports=Bt.default,e.exports.default=e.exports})),qt=He(Ne((function(e){!function(t,r){var n={};!function(e){e.__esModule=!0,e.digestLength=32,e.blockSize=64;var t=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);function r(e,r,n,o,i){for(var s,a,u,c,h,d,f,l,p,g,v,y,m;i>=64;){for(s=r[0],a=r[1],u=r[2],c=r[3],h=r[4],d=r[5],f=r[6],l=r[7],g=0;g<16;g++)v=o+4*g,e[g]=(255&n[v])<<24|(255&n[v+1])<<16|(255&n[v+2])<<8|255&n[v+3];for(g=16;g<64;g++)y=((p=e[g-2])>>>17|p<<15)^(p>>>19|p<<13)^p>>>10,m=((p=e[g-15])>>>7|p<<25)^(p>>>18|p<<14)^p>>>3,e[g]=(y+e[g-7]|0)+(m+e[g-16]|0);for(g=0;g<64;g++)y=(((h>>>6|h<<26)^(h>>>11|h<<21)^(h>>>25|h<<7))+(h&d^~h&f)|0)+(l+(t[g]+e[g]|0)|0)|0,m=((s>>>2|s<<30)^(s>>>13|s<<19)^(s>>>22|s<<10))+(s&a^s&u^a&u)|0,l=f,f=d,d=h,h=c+y|0,c=u,u=a,a=s,s=y+m|0;r[0]+=s,r[1]+=a,r[2]+=u,r[3]+=c,r[4]+=h,r[5]+=d,r[6]+=f,r[7]+=l,o+=64,i-=64}return o}var n=function(){function t(){this.digestLength=e.digestLength,this.blockSize=e.blockSize,this.state=new Int32Array(8),this.temp=new Int32Array(64),this.buffer=new Uint8Array(128),this.bufferLength=0,this.bytesHashed=0,this.finished=!1,this.reset()}return t.prototype.reset=function(){return this.state[0]=1779033703,this.state[1]=3144134277,this.state[2]=1013904242,this.state[3]=2773480762,this.state[4]=1359893119,this.state[5]=2600822924,this.state[6]=528734635,this.state[7]=1541459225,this.bufferLength=0,this.bytesHashed=0,this.finished=!1,this},t.prototype.clean=function(){for(var e=0;e<this.buffer.length;e++)this.buffer[e]=0;for(e=0;e<this.temp.length;e++)this.temp[e]=0;this.reset()},t.prototype.update=function(e,t){if(void 0===t&&(t=e.length),this.finished)throw new Error("SHA256: can't update because hash was finished.");var n=0;if(this.bytesHashed+=t,this.bufferLength>0){for(;this.bufferLength<64&&t>0;)this.buffer[this.bufferLength++]=e[n++],t--;64===this.bufferLength&&(r(this.temp,this.state,this.buffer,0,64),this.bufferLength=0)}for(t>=64&&(n=r(this.temp,this.state,e,n,t),t%=64);t>0;)this.buffer[this.bufferLength++]=e[n++],t--;return this},t.prototype.finish=function(e){if(!this.finished){var t=this.bytesHashed,n=this.bufferLength,o=t/536870912|0,i=t<<3,s=t%64<56?64:128;this.buffer[n]=128;for(var a=n+1;a<s-8;a++)this.buffer[a]=0;this.buffer[s-8]=o>>>24&255,this.buffer[s-7]=o>>>16&255,this.buffer[s-6]=o>>>8&255,this.buffer[s-5]=o>>>0&255,this.buffer[s-4]=i>>>24&255,this.buffer[s-3]=i>>>16&255,this.buffer[s-2]=i>>>8&255,this.buffer[s-1]=i>>>0&255,r(this.temp,this.state,this.buffer,0,s),this.finished=!0}for(a=0;a<8;a++)e[4*a+0]=this.state[a]>>>24&255,e[4*a+1]=this.state[a]>>>16&255,e[4*a+2]=this.state[a]>>>8&255,e[4*a+3]=this.state[a]>>>0&255;return this},t.prototype.digest=function(){var e=new Uint8Array(this.digestLength);return this.finish(e),e},t.prototype._saveState=function(e){for(var t=0;t<this.state.length;t++)e[t]=this.state[t]},t.prototype._restoreState=function(e,t){for(var r=0;r<this.state.length;r++)this.state[r]=e[r];this.bytesHashed=t,this.finished=!1,this.bufferLength=0},t}();e.Hash=n;var o=function(){function e(e){this.inner=new n,this.outer=new n,this.blockSize=this.inner.blockSize,this.digestLength=this.inner.digestLength;var t=new Uint8Array(this.blockSize);if(e.length>this.blockSize)(new n).update(e).finish(t).clean();else for(var r=0;r<e.length;r++)t[r]=e[r];for(r=0;r<t.length;r++)t[r]^=54;this.inner.update(t);for(r=0;r<t.length;r++)t[r]^=106;this.outer.update(t),this.istate=new Uint32Array(8),this.ostate=new Uint32Array(8),this.inner._saveState(this.istate),this.outer._saveState(this.ostate);for(r=0;r<t.length;r++)t[r]=0}return e.prototype.reset=function(){return this.inner._restoreState(this.istate,this.inner.blockSize),this.outer._restoreState(this.ostate,this.outer.blockSize),this},e.prototype.clean=function(){for(var e=0;e<this.istate.length;e++)this.ostate[e]=this.istate[e]=0;this.inner.clean(),this.outer.clean()},e.prototype.update=function(e){return this.inner.update(e),this},e.prototype.finish=function(e){return this.outer.finished?this.outer.finish(e):(this.inner.finish(e),this.outer.update(e,this.digestLength).finish(e)),this},e.prototype.digest=function(){var e=new Uint8Array(this.digestLength);return this.finish(e),e},e}();function i(e){var t=(new n).update(e),r=t.digest();return t.clean(),r}function s(e,t){var r=new o(e).update(t),n=r.digest();return r.clean(),n}function a(e,t,r,n){var o=n[0];if(0===o)throw new Error("hkdf: cannot expand more");t.reset(),o>1&&t.update(e),r&&t.update(r),t.update(n),t.finish(e),n[0]++}e.HMAC=o,e.hash=i,e.default=i,e.hmac=s;var u=new Uint8Array(e.digestLength);function c(e,t,r,n){void 0===t&&(t=u),void 0===n&&(n=32);for(var i=new Uint8Array([1]),c=s(t,e),h=new o(c),d=new Uint8Array(h.digestLength),f=d.length,l=new Uint8Array(n),p=0;p<n;p++)f===d.length&&(a(d,h,r,i),f=0),l[p]=d[f++];return h.clean(),d.fill(0),i.fill(0),l}function h(e,t,r,n){for(var i=new o(e),s=i.digestLength,a=new Uint8Array(4),u=new Uint8Array(s),c=new Uint8Array(s),h=new Uint8Array(n),d=0;d*s<n;d++){var f=d+1;a[0]=f>>>24&255,a[1]=f>>>16&255,a[2]=f>>>8&255,a[3]=f>>>0&255,i.reset(),i.update(t),i.update(a),i.finish(c);for(var l=0;l<s;l++)u[l]=c[l];for(l=2;l<=r;l++){i.reset(),i.update(c).finish(c);for(var p=0;p<s;p++)u[p]^=c[p]}for(l=0;l<s&&d*s+l<n;l++)h[d*s+l]=u[l]}for(d=0;d<s;d++)u[d]=c[d]=0;for(d=0;d<4;d++)a[d]=0;return i.clean(),h}e.hkdf=c,e.pbkdf2=h}(n);var o=n.default;for(var i in n)o[i]=n[i];e.exports=o}()}))),Jt=xe(xt),Wt=Ne((function(e,t){var r=Jt.Buffer;function n(e,t){for(var r in e)t[r]=e[r]}function o(e,t,n){return r(e,t,n)}r.from&&r.alloc&&r.allocUnsafe&&r.allocUnsafeSlow?e.exports=Jt:(n(Jt,t),t.Buffer=o),n(r,o),o.from=function(e,t,n){if("number"==typeof e)throw new TypeError("Argument must not be a number");return r(e,t,n)},o.alloc=function(e,t,n){if("number"!=typeof e)throw new TypeError("Argument must be a number");var o=r(e);return void 0!==t?"string"==typeof n?o.fill(t,n):o.fill(t):o.fill(0),o},o.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return r(e)},o.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return Jt.SlowBuffer(e)}})),Ft=Ne((function(e){var t=65536,r=4294967295;var n=Wt.Buffer,o=je.crypto||je.msCrypto;o&&o.getRandomValues?e.exports=function(e,i){if(e>r)throw new RangeError("requested too many random bytes");var s=n.allocUnsafe(e);if(e>0)if(e>t)for(var a=0;a<e;a+=t)o.getRandomValues(s.slice(a,a+t));else o.getRandomValues(s);if("function"==typeof i)return ae.nextTick((function(){i(null,s)}));return s}:e.exports=function(){throw new Error("Secure random number generation is not supported by this browser.\nUse Chrome, Firefox or Internet Explorer 11")}}));const Yt=new TextEncoder,zt=new TextDecoder;var $t=function(){if("undefined"!=typeof globalThis)return globalThis;if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;throw new Error("unable to locate global object")}();const Vt=e=>{let t=e;return t instanceof Uint8Array&&(t=zt.decode(t)),t=t.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,""),new Uint8Array($t.atob(t).split("").map((e=>e.charCodeAt(0))))};class Gt extends Error{constructor(e){super(e),this.code="ERR_JOSE_GENERIC",this.name=this.constructor.name,Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}class Xt extends Gt{constructor(e,t="unspecified",r="unspecified"){super(e),this.code="ERR_JWT_CLAIM_VALIDATION_FAILED",this.claim=t,this.reason=r}}class Zt extends Gt{constructor(){super(...arguments),this.code="ERR_JOSE_ALG_NOT_ALLOWED"}}class Qt extends Gt{constructor(){super(...arguments),this.code="ERR_JOSE_NOT_SUPPORTED"}}class er extends Gt{constructor(){super(...arguments),this.code="ERR_JWS_INVALID"}}class tr extends Gt{constructor(){super(...arguments),this.code="ERR_JWT_INVALID"}}class rr extends Gt{constructor(){super(...arguments),this.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED",this.message="signature verification failed"}}class nr extends Xt{constructor(){super(...arguments),this.code="ERR_JWT_EXPIRED"}}var or=$t.crypto;function ir(){if(!$t.isSecureContext&&!$t.crypto.subtle)throw new Gt("Web Cryptography API is available only in Secure Contexts. See: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts")}const sr=async e=>{var t,r;const{algorithm:n,keyUsages:o}=function(e){let t,r;switch(e.kty){case"oct":switch(e.alg){case"HS256":case"HS384":case"HS512":t={name:"HMAC",hash:`SHA-${e.alg.substr(-3)}`},r=["sign","verify"];break;case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":throw new Qt(`${e.alg} keys cannot be imported as CryptoKey instances`);case"A128GCM":case"A192GCM":case"A256GCM":case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":t={name:"AES-GCM"},r=["encrypt","decrypt"];break;case"A128KW":case"A192KW":case"A256KW":t={name:"AES-KW"},r=["wrapKey","unwrapKey"];break;case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":t={name:"PBKDF2"},r=["deriveBits"];break;default:throw new Qt('unsupported or invalid JWK "alg" (Algorithm) Parameter value')}break;case"RSA":switch(e.alg){case"PS256":case"PS384":case"PS512":t={name:"RSA-PSS",hash:`SHA-${e.alg.substr(-3)}`},r=e.d?["sign"]:["verify"];break;case"RS256":case"RS384":case"RS512":t={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${e.alg.substr(-3)}`},r=e.d?["sign"]:["verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":t={name:"RSA-OAEP",hash:`SHA-${parseInt(e.alg.substr(-3),10)||1}`},r=e.d?["decrypt","unwrapKey"]:["encrypt","wrapKey"];break;default:throw new Qt('unsupported or invalid JWK "alg" (Algorithm) Parameter value')}break;case"EC":switch(e.alg){case"ES256":case"ES384":case"ES512":t={name:"ECDSA",namedCurve:e.crv},r=e.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":t={name:"ECDH",namedCurve:e.crv},r=e.d?["deriveBits"]:[];break;default:throw new Qt('unsupported or invalid JWK "alg" (Algorithm) Parameter value')}break;default:throw new Qt('unsupported or invalid JWK "kty" (Key Type) Parameter value')}return{algorithm:t,keyUsages:r}}(e);let i="jwk",s={...e};return delete s.alg,"PBKDF2"===n.name&&(i="raw",s=Vt(e.k)),ir(),or.subtle.importKey(i,s,n,null!==(t=e.ext)&&void 0!==t&&t,null!==(r=e.key_ops)&&void 0!==r?r:o)};function ar(e){return!!e&&e.constructor===Object}async function ur(e,t,r){if(!ar(e))throw new TypeError("JWK must be an object");if(t||(t=e.alg),"string"!=typeof t||!t)throw new TypeError('"alg" argument is required when "jwk.alg" is not present');switch(e.kty){case"oct":if("string"!=typeof e.k||!e.k)throw new TypeError('missing "k" (Key Value) Parameter value');return null!=r||(r=!0!==e.ext),r?sr({...e,alg:t,ext:!1}):Vt(e.k);case"RSA":if(void 0!==e.oth)throw new Qt('RSA JWK "oth" (Other Primes Info) Parameter value is unsupported');case"EC":case"OKP":return sr({...e,alg:t});default:throw new Qt('unsupported "kty" (Key Type) Parameter value')}}const cr=async(e,t,r,n)=>{let o;if(ir(),t instanceof Uint8Array){if(!e.startsWith("HS"))throw new TypeError("symmetric keys are only applicable for HMAC-based algorithms");o=await or.subtle.importKey("raw",t,{hash:`SHA-${e.substr(-3)}`,name:"HMAC"},!1,["verify"])}else o=t;return((e,t)=>{if(e.startsWith("HS")){const r=parseInt(e.substr(-3),10),{length:n}=t.algorithm;if("number"!=typeof n||n<r)throw new TypeError(`${e} requires symmetric keys to be ${r} bits or larger`)}if(e.startsWith("RS")||e.startsWith("PS")){const{modulusLength:r}=t.algorithm;if("number"!=typeof r||r<2048)throw new TypeError(`${e} requires key modulusLength to be 2048 bits or larger`)}})(e,o),or.subtle.verify(function(e){switch(e){case"HS256":return{hash:"SHA-256",name:"HMAC"};case"HS384":return{hash:"SHA-384",name:"HMAC"};case"HS512":return{hash:"SHA-512",name:"HMAC"};case"PS256":return{hash:"SHA-256",name:"RSA-PSS",saltLength:32};case"PS384":return{hash:"SHA-384",name:"RSA-PSS",saltLength:48};case"PS512":return{hash:"SHA-512",name:"RSA-PSS",saltLength:64};case"RS256":return{hash:"SHA-256",name:"RSASSA-PKCS1-v1_5"};case"RS384":return{hash:"SHA-384",name:"RSASSA-PKCS1-v1_5"};case"RS512":return{hash:"SHA-512",name:"RSASSA-PKCS1-v1_5"};case"ES256":return{hash:"SHA-256",name:"ECDSA",namedCurve:"P-256"};case"ES384":return{hash:"SHA-384",name:"ECDSA",namedCurve:"P-384"};case"ES512":return{hash:"SHA-512",name:"ECDSA",namedCurve:"P-521"};default:throw new Qt(`alg ${e} is unsupported either by JOSE or your javascript runtime`)}}(e),o,r,n)};const hr=function(e,t,r,n){if(void 0!==n.crit&&void 0===r.crit)throw new e('"crit" (Critical) Header Parameter MUST be integrity protected');if(!r||void 0===r.crit)return new Set;if(!Array.isArray(r.crit)||0===r.crit.length||r.crit.some((e=>"string"!=typeof e||0===e.length)))throw new e('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');for(const o of r.crit){if(!t.has(o))throw new Qt(`Extension Header Parameter "${o}" is not supported by this implementation`);if(void 0===n[o])throw new e(`Extension Header Parameter "${o}" is missing`);if(t.get(o)&&void 0===r[o])throw new e(`Extension Header Parameter "${o}" MUST be integrity protected`)}return new Set(r.crit)}.bind(void 0,er,new Map([["b64",!0]])),dr=((e,t)=>{if(void 0!==t&&(!Array.isArray(t)||t.some((e=>"string"!=typeof e))))throw new TypeError(`"${e}" option must be an array of strings`);if(t)return new Set(t)}).bind(void 0,"algorithms");async function fr(e,t,r){if(!ar(e))throw new er("Flattened JWS must be an object");if(void 0===e.protected&&void 0===e.header)throw new er('Flattened JWS must have either of the "protected" or "header" members');if(void 0!==e.protected&&"string"!=typeof e.protected)throw new er("JWS Protected Header incorrect type");if(void 0===e.payload)throw new er("JWS Payload missing");if("string"!=typeof e.signature)throw new er("JWS Signature missing or incorrect type");if(void 0!==e.header&&!ar(e.header))throw new er("JWS Unprotected Header incorrect type");let n={};if(e.protected){const t=Vt(e.protected);n=JSON.parse(zt.decode(t))}if(!((...e)=>{const t=e.filter(Boolean);if(0===t.length||1===t.length)return!0;let r;for(const e of t){const t=Object.keys(e);if(r&&0!==r.size)for(const e of t){if(r.has(e))return!1;r.add(e)}else r=new Set(t)}return!0})(n,e.header))throw new er("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");const o={...n,...e.header};let i=!0;if(hr(n,o).has("b64")&&(i=n.b64,"boolean"!=typeof i))throw new er('The "b64" (base64url-encode payload) Header Parameter must be a boolean');const{alg:s}=o;if("string"!=typeof s||!s)throw new er('JWS "alg" (Algorithm) Header Parameter missing or invalid');const a=r&&dr(r.algorithms);if(a&&!a.has(s))throw new Zt('"alg" (Algorithm) Header Parameter not allowed');if(i){if("string"!=typeof e.payload)throw new er("JWS Payload must be a string")}else if("string"!=typeof e.payload&&!(e.payload instanceof Uint8Array))throw new er("JWS Payload must be a string or an Uint8Array instance");"function"==typeof t&&(t=await t(n,e)),((e,t)=>{if(e.startsWith("HS")||"dir"===e||e.startsWith("PBES2")||e.match(/^A\d{3}(?:GCM)KW$/)){if(t instanceof Uint8Array||"secret"===t.type)return;throw new TypeError('CryptoKey or KeyObject instances for symmetric algorithms must be of type "secret"')}if(t instanceof Uint8Array)throw new TypeError("CryptoKey or KeyObject instances must be used for asymmetric algorithms");if("secret"===t.type)throw new TypeError('CryptoKey or KeyObject instances for asymmetric algorithms must not be of type "secret"')})(s,t);const u=function(...e){const t=e.reduce(((e,{length:t})=>e+t),0),r=new Uint8Array(t);let n=0;return e.forEach((e=>{r.set(e,n),n+=e.length})),r}(Yt.encode(e.protected||""),Yt.encode("."),"string"==typeof e.payload?Yt.encode(e.payload):e.payload),c=Vt(e.signature);if(!await cr(s,t,c,u))throw new rr;let h;h=i?Vt(e.payload):"string"==typeof e.payload?Yt.encode(e.payload):e.payload;const d={payload:h};return void 0!==e.protected&&(d.protectedHeader=n),void 0!==e.header&&(d.unprotectedHeader=e.header),d}const lr=86400,pr=/^(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)$/i;var gr=e=>{const t=pr.exec(e);if(!t)throw new TypeError("invalid time period format");const r=parseFloat(t[1]);switch(t[2].toLowerCase()){case"sec":case"secs":case"second":case"seconds":case"s":return Math.round(r);case"minute":case"minutes":case"min":case"mins":case"m":return Math.round(60*r);case"hour":case"hours":case"hr":case"hrs":case"h":return Math.round(3600*r);case"day":case"days":case"d":return Math.round(r*lr);case"week":case"weeks":case"w":return Math.round(604800*r);default:return Math.round(31557600*r)}};const vr=e=>e.toLowerCase().replace(/^application\//,"");var yr=(e,t,r={})=>{const{typ:n}=r;if(n&&("string"!=typeof e.typ||vr(e.typ)!==vr(n)))throw new Xt('unexpected "typ" JWT header value',"typ","check_failed");let o;try{o=JSON.parse(zt.decode(t))}catch(e){}if("object"!=typeof o||!o||Array.isArray(o))throw new tr("JWT Claims Set must be a top-level JSON object");const{issuer:i}=r;if(i&&!("string"==typeof i?[i]:i).includes(o.iss))throw new Xt('unexpected "iss" claim value',"iss","check_failed");const{subject:s}=r;if(s&&o.sub!==s)throw new Xt('unexpected "sub" claim value',"sub","check_failed");const{audience:a}=r;if(a&&(u=o.aud,c="string"==typeof a?[a]:a,!("string"==typeof u?c.includes(u):c.some(Set.prototype.has.bind(new Set(u))))))throw new Xt('unexpected "aud" claim value',"aud","check_failed");var u,c;let h;switch(typeof r.clockTolerance){case"string":h=gr(r.clockTolerance);break;case"number":h=r.clockTolerance;break;case"undefined":h=0;break;default:throw new TypeError("invalid clockTolerance option type")}const{currentDate:d}=r,f=(l=d||new Date,Math.floor(l.getTime()/1e3));var l;if(void 0!==o.iat||r.maxTokenAge){if("number"!=typeof o.iat)throw new Xt('"iat" claim must be a number',"iat","invalid");if(void 0===o.exp&&o.iat>f+h)throw new Xt('"iat" claim timestamp check failed (it should be in the past)',"iat","check_failed")}if(void 0!==o.nbf){if("number"!=typeof o.nbf)throw new Xt('"nbf" claim must be a number',"nbf","invalid");if(o.nbf>f+h)throw new Xt('"nbf" claim timestamp check failed',"nbf","check_failed")}if(void 0!==o.exp){if("number"!=typeof o.exp)throw new Xt('"exp" claim must be a number',"exp","invalid");if(o.exp<=f-h)throw new nr('"exp" claim timestamp check failed',"exp","check_failed")}if(r.maxTokenAge){const e=f-o.iat;if(e-h>("number"==typeof r.maxTokenAge?r.maxTokenAge:gr(r.maxTokenAge)))throw new nr('"iat" claim timestamp check failed (too far in the past)',"iat","check_failed");if(e<0-h)throw new Xt('"iat" claim timestamp check failed (it should be in the past)',"iat","check_failed")}return o};async function mr(e,t,r){const n=await async function(e,t,r){if(e instanceof Uint8Array&&(e=zt.decode(e)),"string"!=typeof e)throw new er("Compact JWS must be a string or Uint8Array");const{0:n,1:o,2:i,length:s}=e.split(".");if(3!==s)throw new er("Invalid Compact JWS");const a=await fr({payload:o||void 0,protected:n||void 0,signature:i||void 0},t,r);return{payload:a.payload,protectedHeader:a.protectedHeader}}(e,t,r);return{payload:yr(n.protectedHeader,n.payload,r),protectedHeader:n.protectedHeader}}class wr{constructor(){}static base64URLEncode(e){return Kt.encode(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}static getCodeVerifier(){return this.base64URLEncode(Ft(32))}static getCodeChallenge(e){return this.base64URLEncode(new Buffer(qt((new TextEncoder).encode(e))))}static getSupportedSignatureAlgorithms(){return["RS256","RS512","RS384","PS256"]}static getJWKForTheIdToken(e,t){const r=JSON.parse(Kt.decode(e,"utf8"));for(const e of t)if(r.kid===e.kid)return ur({alg:e.alg,e:e.e,kty:e.kty,n:e.n});return Promise.reject(new Ie("CRYPTO_UTIL-GTFTIT-IV01","crypto-utils","getJWKForTheIdToken","kid not found.","Failed to find the 'kid' specified in the id_token. 'kid' found in the header : "+r.kid+", Expected values: "+t.map((e=>e.kid)).join(", ")))}static isValidIdToken(e,t,r,n,o,i){return mr(e,t,{algorithms:this.getSupportedSignatureAlgorithms(),audience:r,clockTolerance:i,issuer:n,subject:o}).then((()=>Promise.resolve(!0))).catch((e=>Promise.reject(new Ie("CRYPTO_UTIL-IVIT-IV02","crypto-utils","isValidIdToken","Validating ID token failed",e))))}static decodeIDToken(e){try{const t=Kt.decode(e.split(".")[1],"utf8");return JSON.parse(t)}catch(e){throw new Ie("CRYPTO_UTIL-DIT-IV01","crypto-utils","decodeIDToken","Decoding ID token failed.",e)}}}class _r{constructor(){}static getAuthenticatedUserInfo(e){var t,r,n;const o=wr.decodeIDToken(e),i=this.getTenantDomainFromIdTokenPayload(o),s=this.extractUserName(o),a=null!==(t=o.given_name)&&void 0!==t?t:"",u=null!==(r=o.family_name)&&void 0!==r?r:"",c=a&&u?`${a} ${u}`:a||(u||""),h=null!==(n=o.preferred_username)&&void 0!==n?n:c;return Object.assign({displayName:h,tenantDomain:i,username:s},this.filterClaimsFromIDTokenPayload(o))}static filterClaimsFromIDTokenPayload(e){const t=Object.assign({},e);null==t||delete t.iss,null==t||delete t.sub,null==t||delete t.aud,null==t||delete t.exp,null==t||delete t.iat,null==t||delete t.acr,null==t||delete t.amr,null==t||delete t.azp,null==t||delete t.auth_time,null==t||delete t.nonce,null==t||delete t.c_hash,null==t||delete t.at_hash,null==t||delete t.nbf,null==t||delete t.isk,null==t||delete t.sid;const r={};return Object.entries(t).forEach((([e,t])=>{const n=e.split("_").map(((e,t)=>0===t?e:[e[0].toUpperCase(),...e.slice(1)].join(""))).join("");r[n]=t})),r}static getTokenRequestHeaders(){return{Accept:"application/json","Content-Type":"application/x-www-form-urlencoded"}}}_r.extractUserName=(e,t="@")=>{const r=e.sub.split(t);return r.length>2&&r.pop(),r.join(t)},_r.getTenantDomainFromIdTokenPayload=(e,t="@")=>{const r=e.sub.split(t);return r.length>2?r[r.length-1]:""};class Sr{constructor(e){this._dataLayer=e,this._config=()=>t(this,void 0,void 0,(function*(){return yield this._dataLayer.getConfigData()})),this._oidcProviderMetaData=()=>t(this,void 0,void 0,(function*(){return yield this._dataLayer.getOIDCProviderMetaData()}))}resolveWellKnownEndpoint(){return t(this,void 0,void 0,(function*(){const e=yield this._config();return e.wellKnownEndpoint?e.serverOrigin+e.wellKnownEndpoint:e.serverOrigin+c}))}resolveEndpoints(e){return t(this,void 0,void 0,(function*(){const t={},r=yield this._config();return r.overrideWellEndpointConfig&&r.endpoints&&Object.keys(r.endpoints).forEach((e=>{const n=e.replace(/[A-Z]/g,(e=>`_${e.toLowerCase()}`));t[n]=(null==r?void 0:r.endpoints)?r.endpoints[e]:""})),Object.assign(Object.assign({},e),t)}))}resolveFallbackEndpoints(){return t(this,void 0,void 0,(function*(){const e={},t=yield this._config();(null==t?void 0:t.endpoints)&&Object.keys(t.endpoints).forEach((r=>{const n=r.split("_").map(((e,t)=>0!==t?e[0].toUpperCase()+e.substring(1):e)).join("");e[n]=(null==t?void 0:t.endpoints)?t.endpoints[n]:""}));const r={[h]:t.serverOrigin+n,end_session_endpoint:t.serverOrigin+i,jwks_uri:t.serverOrigin+s,check_session_iframe:t.serverOrigin+o,revocation_endpoint:t.serverOrigin+a,token_endpoint:t.serverOrigin+u};return Object.assign(Object.assign({},r),e)}))}validateIdToken(e){return t(this,void 0,void 0,(function*(){const r=(yield this._dataLayer.getOIDCProviderMetaData()).jwks_uri;return r&&0!==r.trim().length?Ue.get(r).then((r=>t(this,void 0,void 0,(function*(){if(200!==r.status)return Promise.reject(new Ie("AUTH_HELPER-VIT-NR02","authentication-helper","validateIdToken","Invalid response status received for jwks request.","The request sent to get the jwks returned "+r.status+" , which is invalid."));const n=(yield this._oidcProviderMetaData()).issuer,o=(yield this.resolveWellKnownEndpoint()).split("/.well-known")[0];return n&&n===o?wr.getJWKForTheIdToken(e.split(".")[0],r.data.keys).then((r=>t(this,void 0,void 0,(function*(){return wr.isValidIdToken(e,r,(yield this._config()).clientID,n,_r.getAuthenticatedUserInfo(e).username,(yield this._config()).clockTolerance).then((e=>e)).catch((e=>Promise.reject(new Ie("AUTH_HELPER-VIT-ES03","authentication-helper","validateIdToken",void 0,void 0,e))))})))).catch((e=>Promise.reject(new Ie("AUTH_HELPER-VIT-ES04","authentication-helper","validateIdToken",void 0,void 0,e)))):Promise.resolve(!1)})))).catch((e=>{var t,r,n;return Promise.reject(new Le("AUTH_HELPER-VIT-NR05","authentication-helper","validateIdToken","Request to jwks endpoint failed.","The request sent to get the jwks from the server failed.",null!==(t=null==e?void 0:e.code)&&void 0!==t?t:"",null==e?void 0:e.message,null===(r=null==e?void 0:e.response)||void 0===r?void 0:r.status,null===(n=null==e?void 0:e.response)||void 0===n?void 0:n.data))})):Promise.reject(new Ie("AUTH_HELPER-VIT-NF01","authentication-helper","validateIdToken","JWKS endpoint not found.","No JWKS endpoint was found in the OIDC provider meta data returned by the well-known endpoint or the JWKS endpoint passed to the SDK is empty."))}))}replaceCustomGrantTemplateTags(e){var r;return t(this,void 0,void 0,(function*(){let t=S;const n=yield this._config(),o=yield this._dataLayer.getSessionData();return n.scope&&n.scope.length>0&&(n.scope.includes(S)||n.scope.push(S),t=n.scope.join(" ")),e.replace(f,o.access_token).replace(l,_r.getAuthenticatedUserInfo(o.id_token).username).replace(p,t).replace(g,n.clientID).replace(v,null!==(r=n.clientSecret)&&void 0!==r?r:"")}))}clearUserSessionData(){return t(this,void 0,void 0,(function*(){yield this._dataLayer.removeOIDCProviderMetaData(),yield this._dataLayer.removeTemporaryData(),yield this._dataLayer.removeSessionData()}))}handleTokenResponse(e){return t(this,void 0,void 0,(function*(){if(200!==e.status)return Promise.reject(new Ie("AUTH_HELPER-HTR-NR01","authentication-helper","handleTokenResponse","Invalid response status received for token request.","The request sent to get the token returned "+e.status+" , which is invalid."));if((yield this._config()).validateIDToken)return this.validateIdToken(e.data.id_token).then((r=>t(this,void 0,void 0,(function*(){if(r){yield this._dataLayer.setSessionData(e.data);const t={accessToken:e.data.access_token,expiresIn:e.data.expires_in,idToken:e.data.id_token,refreshToken:e.data.refresh_token,scope:e.data.scope,tokenType:e.data.token_type};return Promise.resolve(t)}return Promise.reject(new Ie("AUTH_HELPER-HTR-IV02","authentication-helper","handleTokenResponse","The id token returned is not valid.","The id token returned has failed the validation check."))})))).catch((e=>Promise.reject(new Ie("AUTH_HELPER-HAT-ES03","authentication-helper","handleTokenResponse",void 0,void 0,e))));{const t={accessToken:e.data.access_token,expiresIn:e.data.expires_in,idToken:e.data.id_token,refreshToken:e.data.refresh_token,scope:e.data.scope,tokenType:e.data.token_type};return yield this._dataLayer.setSessionData(e.data),Promise.resolve(t)}}))}}class br{constructor(e){this._authenticationHelper=new Sr(e),this._dataLayer=e,this._config=()=>t(this,void 0,void 0,(function*(){return yield this._dataLayer.getConfigData()})),this._oidcProviderMetaData=()=>t(this,void 0,void 0,(function*(){return yield this._dataLayer.getOIDCProviderMetaData()}))}getAuthorizationURL(e){return t(this,void 0,void 0,(function*(){const t=yield this._dataLayer.getOIDCProviderMetaDataParameter(h),r=yield this._config();if(!t||0===t.trim().length)throw new Ie("AUTH_CORE-GAU-NF01","authentication-core","getAuthorizationURL","No authorization endpoint found.","No authorization endpoint was found in the OIDC provider meta data from the well-known endpoint or the authorization endpoint passed to the SDK is empty.");const n=new URL(t);n.searchParams.append("response_type","code"),n.searchParams.append("client_id",r.clientID);let o=S;if(r.scope&&r.scope.length>0&&(r.scope.includes(S)||r.scope.push(S),o=r.scope.join(" ")),n.searchParams.append("scope",o),n.searchParams.append("redirect_uri",r.signInRedirectURL),r.responseMode&&n.searchParams.append("response_mode",r.responseMode),r.enablePKCE){const e=wr.getCodeVerifier(),t=wr.getCodeChallenge(e);yield this._dataLayer.setTemporaryDataParameter(m,e),n.searchParams.append("code_challenge_method","S256"),n.searchParams.append("code_challenge",t)}r.prompt&&n.searchParams.append("prompt",r.prompt);const i=e;if(i)for(const[e,t]of Object.entries(i))""!=e&&""!=t&&n.searchParams.append(e,t.toString());return n.toString()}))}requestAccessToken(e,r){return t(this,void 0,void 0,(function*(){const t=(yield this._oidcProviderMetaData()).token_endpoint,n=yield this._config();if(!t||0===t.trim().length)return Promise.reject(new Ie("AUTH_CORE-RAT1-NF01","authentication-core","requestAccessToken","Token endpoint not found.","No token endpoint was found in the OIDC provider meta data returned by the well-known endpoint or the token endpoint passed to the SDK is empty."));r&&(yield this._dataLayer.setSessionDataParameter(w,r));const o=[];o.push(`client_id=${n.clientID}`),n.clientSecret&&n.clientSecret.trim().length>0&&o.push(`client_secret=${n.clientSecret}`);const i=e;return o.push(`code=${i}`),o.push("grant_type=authorization_code"),o.push(`redirect_uri=${n.signInRedirectURL}`),n.enablePKCE&&(o.push(`code_verifier=${yield this._dataLayer.getTemporaryDataParameter(m)}`),yield this._dataLayer.removeTemporaryDataParameter(m)),Ue.post(t,o.join("&"),{headers:_r.getTokenRequestHeaders()}).then((e=>this._authenticationHelper.handleTokenResponse(e).then((e=>e)).catch((e=>Promise.reject(new Ie("AUTH_CORE-RAT1-ES02","authentication-core","requestAccessToken",void 0,void 0,e)))))).catch((e=>{var t,r,n;return Promise.reject(new Le("AUTH_CORE-RAT1-NR03","authentication-core","requestAccessToken","Requesting access token failed","The request to get the access token from the server failed.",null!==(t=null==e?void 0:e.code)&&void 0!==t?t:"",null==e?void 0:e.message,null===(r=null==e?void 0:e.response)||void 0===r?void 0:r.status,null===(n=null==e?void 0:e.response)||void 0===n?void 0:n.data))}))}))}refreshAccessToken(){return t(this,void 0,void 0,(function*(){const e=(yield this._oidcProviderMetaData()).token_endpoint,t=yield this._config(),r=yield this._dataLayer.getSessionData();if(!r.refresh_token)return Promise.reject(new Ie("AUTH_CORE-RAT2-NF01","authentication-core","refreshAccessToken","No refresh token found.","There was no refresh token found. The identity server doesn't return a refresh token if the refresh token grant is not enabled."));if(!e||0===e.trim().length)return Promise.reject(new Ie("AUTH_CORE-RAT2-NF02","authentication-core","refreshAccessToken","No refresh token endpoint found.","No refresh token endpoint was in the OIDC provider meta data returned by the well-known endpoint or the refresh token endpoint passed to the SDK is empty."));const n=[];return n.push(`client_id=${t.clientID}`),n.push(`refresh_token=${r.refresh_token}`),n.push("grant_type=refresh_token"),t.clientSecret&&t.clientSecret.trim().length>0&&n.push(`client_secret=${t.clientSecret}`),Ue.post(e,n.join("&"),{headers:_r.getTokenRequestHeaders()}).then((e=>this._authenticationHelper.handleTokenResponse(e).then((e=>e)).catch((e=>Promise.reject(new Ie("AUTH_CORE-RAT2-ES03","authentication-core","refreshAccessToken",void 0,void 0,e)))))).catch((e=>{var t,r,n;return Promise.reject(new Le("AUTH_CORE-RAT2-NR03","authentication-core","refreshAccessToken","Refresh access token request failed.","The request to refresh the access token failed.",null!==(t=null==e?void 0:e.code)&&void 0!==t?t:"",null==e?void 0:e.message,null===(r=null==e?void 0:e.response)||void 0===r?void 0:r.status,null===(n=null==e?void 0:e.response)||void 0===n?void 0:n.data))}))}))}revokeAccessToken(){return t(this,void 0,void 0,(function*(){const e=(yield this._oidcProviderMetaData()).revocation_endpoint,t=yield this._config();if(!e||0===e.trim().length)return Promise.reject(new Ie("AUTH_CORE-RAT3-NF01","authentication-core","revokeAccessToken","No revoke access token endpoint found.","No revoke access token endpoint was found in the OIDC provider meta data returned by the well-known endpoint or the revoke access token endpoint passed to the SDK is empty."));const r=[];return r.push(`client_id=${t.clientID}`),r.push(`token=${(yield this._dataLayer.getSessionData()).access_token}`),r.push("token_type_hint=access_token"),Ue.post(e,r.join("&"),{headers:_r.getTokenRequestHeaders(),withCredentials:!0}).then((e=>200!==e.status?Promise.reject(new Ie("AUTH_CORE-RAT3-NR02","authentication-core","revokeAccessToken","Invalid response status received for revoke access token request.","The request sent to revoke the access token returned "+e.status+" , which is invalid.")):(this._authenticationHelper.clearUserSessionData(),Promise.resolve(e)))).catch((e=>{var t,r,n;return Promise.reject(new Le("AUTH_CORE-RAT3-NR03","authentication-core","revokeAccessToken","The request to revoke access token failed.","The request sent to revoke the access token failed.",null!==(t=null==e?void 0:e.code)&&void 0!==t?t:"",null==e?void 0:e.message,null===(r=null==e?void 0:e.response)||void 0===r?void 0:r.status,null===(n=null==e?void 0:e.response)||void 0===n?void 0:n.data))}))}))}requestCustomGrant(e){return t(this,void 0,void 0,(function*(){const r=yield this._oidcProviderMetaData();let n;if(n=e.tokenEndpoint&&0!==e.tokenEndpoint.trim().length?e.tokenEndpoint:r.token_endpoint,!n||0===n.trim().length)return Promise.reject(new Ie("AUTH_CORE-RCG-NF01","authentication-core","requestCustomGrant","Token endpoint not found.","No token endpoint was found in the OIDC provider meta data returned by the well-known endpoint or the token endpoint passed to the SDK is empty."));const o={data:(yield Promise.all(Object.entries(e.data).map((([e,r])=>t(this,void 0,void 0,(function*(){const t=yield this._authenticationHelper.replaceCustomGrantTemplateTags(r);return`${e}=${t}`})))))).join("&"),headers:Object.assign({},_r.getTokenRequestHeaders()),method:"POST",url:n};return e.attachToken&&(o.headers=Object.assign(Object.assign({},o.headers),{Authorization:`Bearer ${(yield this._dataLayer.getSessionData()).access_token}`})),Ue(o).then((t=>200!==t.status?Promise.reject(new Ie("AUTH_CORE-RCG-NR02","authentication-core","requestCustomGrant","Invalid response status received for the custom grant request.","The request sent to get the custom grant returned "+t.status+" , which is invalid.")):e.returnsSession?this._authenticationHelper.handleTokenResponse(t).then((e=>e)).catch((e=>Promise.reject(new Ie("AUTH_CORE-RCG-ES03","authentication-core","requestCustomGrant",void 0,void 0,e)))):Promise.resolve(t))).catch((e=>{var t,r,n;return Promise.reject(new Le("AUTH_CORE-RCG-NR04","authentication-core","requestCustomGrant","The custom grant request failed.","The request sent to get the custom grant failed.",null!==(t=null==e?void 0:e.code)&&void 0!==t?t:"",null==e?void 0:e.message,null===(r=null==e?void 0:e.response)||void 0===r?void 0:r.status,null===(n=null==e?void 0:e.response)||void 0===n?void 0:n.data))}))}))}getBasicUserInfo(){return t(this,void 0,void 0,(function*(){const e=yield this._dataLayer.getSessionData(),t=_r.getAuthenticatedUserInfo(null==e?void 0:e.id_token);let r={allowedScopes:e.scope,sessionState:e.session_state,username:t.username};return t.displayName&&""!==t.displayName||delete t.displayName,t.tenantDomain&&""!==t.tenantDomain||delete t.tenantDomain,r=Object.assign(Object.assign({},r),t),r}))}getDecodedIDToken(){return t(this,void 0,void 0,(function*(){const e=(yield this._dataLayer.getSessionData()).id_token;return wr.decodeIDToken(e)}))}getIDToken(){return t(this,void 0,void 0,(function*(){return(yield this._dataLayer.getSessionData()).id_token}))}getOIDCProviderMetaData(e){return t(this,void 0,void 0,(function*(){if(!e&&(yield this._dataLayer.getTemporaryDataParameter(d)))return Promise.resolve(!0);const r=yield this._authenticationHelper.resolveWellKnownEndpoint();return Ue.get(r).then((e=>t(this,void 0,void 0,(function*(){return 200!==e.status?Promise.reject(new Ie("AUTH_CORE-GOPM-NR01","authentication-core","getOIDCProviderMetaData","Invalid response status received for OIDC provider meta data request.","The request sent to the well-known endpoint to get the OIDC provider meta data returned "+e.status+" , which is invalid.")):(yield this._dataLayer.setOIDCProviderMetaData(yield this._authenticationHelper.resolveEndpoints(e.data)),yield this._dataLayer.setTemporaryDataParameter(d,!0),Promise.resolve(!0))})))).catch((()=>t(this,void 0,void 0,(function*(){return yield this._dataLayer.setOIDCProviderMetaData(yield this._authenticationHelper.resolveFallbackEndpoints()),yield this._dataLayer.setTemporaryDataParameter(d,!0),Promise.resolve(!0)}))))}))}getOIDCServiceEndpoints(){return t(this,void 0,void 0,(function*(){const e=yield this._oidcProviderMetaData();return{authorizationEndpoint:e.authorization_endpoint,checkSessionIframe:e.check_session_iframe,endSessionEndpoint:e.end_session_endpoint,introspectionEndpoint:e.introspection_endpoint,issuer:e.issuer,jwksUri:e.jwks_uri,registrationEndpoint:e.registration_endpoint,revocationEndpoint:e.revocation_endpoint,tokenEndpoint:e.token_endpoint,userinfoEndpoint:e.userinfo_endpoint,wellKnownEndpoint:yield this._authenticationHelper.resolveWellKnownEndpoint()}}))}getSignOutURL(){var e,r,n;return t(this,void 0,void 0,(function*(){const t=null===(e=yield this._oidcProviderMetaData())||void 0===e?void 0:e.end_session_endpoint,o=yield this._config();if(!t||0===t.trim().length)throw new Ie("AUTH_CORE-GSOU-NF01","authentication-core","getSignOutURL","Sign-out endpoint not found.","No sign-out endpoint was found in the OIDC provider meta data returned by the well-known endpoint or the sign-out endpoint passed to the SDK is empty.");const i=null===(r=yield this._dataLayer.getSessionData())||void 0===r?void 0:r.id_token;if(!i||0===i.trim().length)throw new Ie("AUTH_CORE-GSOU-NF02","authentication-core","getSignOutURL","ID token n0t found.","No ID token could be found. Either the session information is lost or you have not signed in.");const s=null!==(n=null==o?void 0:o.signOutRedirectURL)&&void 0!==n?n:null==o?void 0:o.signInRedirectURL;if(!s||0===s.trim().length)throw new Ie("AUTH_CORE-GSOU-NF03","authentication-core","getSignOutURL","No sign-out redirect URL found.","The sign-out redirect URL cannot be found or the URL passed to the SDK is empty. No sign-in redirect URL has been found either. ");return`${t}?id_token_hint=${i}&post_logout_redirect_uri=${s}&state=sign_out_success`}))}signOut(){return t(this,void 0,void 0,(function*(){const e=yield this.getSignOutURL();return this._authenticationHelper.clearUserSessionData(),e}))}getAccessToken(){var e;return t(this,void 0,void 0,(function*(){return null===(e=yield this._dataLayer.getSessionData())||void 0===e?void 0:e.access_token}))}isAuthenticated(){return t(this,void 0,void 0,(function*(){return Boolean(yield this.getAccessToken())}))}getPKCECode(){return t(this,void 0,void 0,(function*(){return yield this._dataLayer.getTemporaryDataParameter(m)}))}setPKCECode(e){return t(this,void 0,void 0,(function*(){return yield this._dataLayer.setTemporaryDataParameter(m,e)}))}updateConfig(e){return t(this,void 0,void 0,(function*(){yield this._dataLayer.setConfigData(e)}))}}class Tr{constructor(e,t){this._id=e,this._store=t}setDataInBulk(e,r){var n;return t(this,void 0,void 0,(function*(){const t=null!==(n=yield this._store.getData(e))&&void 0!==n?n:null,o=t&&JSON.parse(t),i=Object.assign(Object.assign({},o),r),s=JSON.stringify(i);yield this._store.setData(e,s)}))}setValue(e,r,n){var o;return t(this,void 0,void 0,(function*(){const t=null!==(o=yield this._store.getData(e))&&void 0!==o?o:null,i=t&&JSON.parse(t),s=Object.assign(Object.assign({},i),{[r]:n}),a=JSON.stringify(s);yield this._store.setData(e,a)}))}removeValue(e,r){var n;return t(this,void 0,void 0,(function*(){const t=null!==(n=yield this._store.getData(e))&&void 0!==n?n:null,o=t&&JSON.parse(t),i=Object.assign({},o);delete i[r];const s=JSON.stringify(i);yield this._store.setData(e,s)}))}_resolveKey(e){return`${e}-${this._id}`}setConfigData(r){return t(this,void 0,void 0,(function*(){yield this.setDataInBulk(this._resolveKey(e.Stores.ConfigData),r)}))}setOIDCProviderMetaData(r){return t(this,void 0,void 0,(function*(){this.setDataInBulk(this._resolveKey(e.Stores.OIDCProviderMetaData),r)}))}setTemporaryData(r){return t(this,void 0,void 0,(function*(){this.setDataInBulk(this._resolveKey(e.Stores.TemporaryData),r)}))}setSessionData(r){return t(this,void 0,void 0,(function*(){this.setDataInBulk(this._resolveKey(e.Stores.SessionData),r)}))}getConfigData(){var r;return t(this,void 0,void 0,(function*(){return JSON.parse(null!==(r=yield this._store.getData(this._resolveKey(e.Stores.ConfigData)))&&void 0!==r?r:null)}))}getOIDCProviderMetaData(){var r;return t(this,void 0,void 0,(function*(){return JSON.parse(null!==(r=yield this._store.getData(this._resolveKey(e.Stores.OIDCProviderMetaData)))&&void 0!==r?r:null)}))}getTemporaryData(){var r;return t(this,void 0,void 0,(function*(){return JSON.parse(null!==(r=yield this._store.getData(this._resolveKey(e.Stores.TemporaryData)))&&void 0!==r?r:null)}))}getSessionData(){var r;return t(this,void 0,void 0,(function*(){return JSON.parse(null!==(r=yield this._store.getData(this._resolveKey(e.Stores.SessionData)))&&void 0!==r?r:null)}))}removeConfigData(){return t(this,void 0,void 0,(function*(){yield this._store.removeData(this._resolveKey(e.Stores.ConfigData))}))}removeOIDCProviderMetaData(){return t(this,void 0,void 0,(function*(){yield this._store.removeData(this._resolveKey(e.Stores.OIDCProviderMetaData))}))}removeTemporaryData(){return t(this,void 0,void 0,(function*(){yield this._store.removeData(this._resolveKey(e.Stores.TemporaryData))}))}removeSessionData(){return t(this,void 0,void 0,(function*(){yield this._store.removeData(this._resolveKey(e.Stores.SessionData))}))}getConfigDataParameter(r){return t(this,void 0,void 0,(function*(){const t=yield this._store.getData(this._resolveKey(e.Stores.ConfigData));return t&&JSON.parse(t)[r]}))}getOIDCProviderMetaDataParameter(r){return t(this,void 0,void 0,(function*(){const t=yield this._store.getData(this._resolveKey(e.Stores.OIDCProviderMetaData));return t&&JSON.parse(t)[r]}))}getTemporaryDataParameter(r){return t(this,void 0,void 0,(function*(){const t=yield this._store.getData(this._resolveKey(e.Stores.TemporaryData));return t&&JSON.parse(t)[r]}))}getSessionDataParameter(r){return t(this,void 0,void 0,(function*(){const t=yield this._store.getData(this._resolveKey(e.Stores.SessionData));return t&&JSON.parse(t)[r]}))}setConfigDataParameter(r,n){return t(this,void 0,void 0,(function*(){yield this.setValue(this._resolveKey(e.Stores.ConfigData),r,n)}))}setOIDCProviderMetaDataParameter(r,n){return t(this,void 0,void 0,(function*(){yield this.setValue(this._resolveKey(e.Stores.OIDCProviderMetaData),r,n)}))}setTemporaryDataParameter(r,n){return t(this,void 0,void 0,(function*(){yield this.setValue(this._resolveKey(e.Stores.TemporaryData),r,n)}))}setSessionDataParameter(r,n){return t(this,void 0,void 0,(function*(){yield this.setValue(this._resolveKey(e.Stores.SessionData),r,n)}))}removeConfigDataParameter(r){return t(this,void 0,void 0,(function*(){yield this.removeValue(this._resolveKey(e.Stores.ConfigData),r)}))}removeOIDCProviderMetaDataParameter(r){return t(this,void 0,void 0,(function*(){yield this.removeValue(this._resolveKey(e.Stores.OIDCProviderMetaData),r)}))}removeTemporaryDataParameter(r){return t(this,void 0,void 0,(function*(){yield this.removeValue(this._resolveKey(e.Stores.TemporaryData),r)}))}removeSessionDataParameter(r){return t(this,void 0,void 0,(function*(){yield this.removeValue(this._resolveKey(e.Stores.SessionData),r)}))}}const Ar={clientHost:origin,clockTolerance:300,enablePKCE:!0,responseMode:e.ResponseMode.query,scope:[S],validateIDToken:!0};class Er{constructor(e){Er._instanceID?Er._instanceID+=1:Er._instanceID=0,this._dataLayer=new Tr(`instance_${Er._instanceID}`,e),this._authenticationCore=new br(this._dataLayer)}initialize(e){return t(this,void 0,void 0,(function*(){yield this._dataLayer.setConfigData(Object.assign(Object.assign({},Ar),e))}))}getDataLayer(){return this._dataLayer}getAuthorizationURL(e){return t(this,void 0,void 0,(function*(){const t=Object.assign({},e);return null==t||delete t.forceInit,(yield this._dataLayer.getTemporaryDataParameter(d))?this._authenticationCore.getAuthorizationURL(t):this._authenticationCore.getOIDCProviderMetaData(null==e?void 0:e.forceInit).then((()=>this._authenticationCore.getAuthorizationURL(t)))}))}requestAccessToken(e,r){return t(this,void 0,void 0,(function*(){return(yield this._dataLayer.getTemporaryDataParameter(d))?this._authenticationCore.requestAccessToken(e,r):this._authenticationCore.getOIDCProviderMetaData(!1).then((()=>this._authenticationCore.requestAccessToken(e,r)))}))}signOut(){return t(this,void 0,void 0,(function*(){return this._authenticationCore.signOut()}))}getSignOutURL(){return t(this,void 0,void 0,(function*(){return this._authenticationCore.getSignOutURL()}))}getOIDCServiceEndpoints(){return t(this,void 0,void 0,(function*(){return this._authenticationCore.getOIDCServiceEndpoints()}))}getDecodedIDToken(){return t(this,void 0,void 0,(function*(){return this._authenticationCore.getDecodedIDToken()}))}getIDToken(){return t(this,void 0,void 0,(function*(){return this._authenticationCore.getIDToken()}))}getBasicUserInfo(){return t(this,void 0,void 0,(function*(){return this._authenticationCore.getBasicUserInfo()}))}revokeAccessToken(){return this._authenticationCore.revokeAccessToken()}refreshAccessToken(){return this._authenticationCore.refreshAccessToken()}getAccessToken(){return t(this,void 0,void 0,(function*(){return this._authenticationCore.getAccessToken()}))}requestCustomGrant(e){return this._authenticationCore.requestCustomGrant(e)}isAuthenticated(){return t(this,void 0,void 0,(function*(){return this._authenticationCore.isAuthenticated()}))}getPKCECode(){return t(this,void 0,void 0,(function*(){return this._authenticationCore.getPKCECode()}))}setPKCECode(e){return t(this,void 0,void 0,(function*(){yield this._authenticationCore.setPKCECode(e)}))}static isSignOutSuccessful(e){const t=new URL(e),r=t.searchParams.get("state"),n=Boolean(t.searchParams.get("error"));return!!r&&(r===_&&!n)}updateConfig(e){this._authenticationCore.updateConfig(e)}}return e.AUTHORIZATION_CODE="code",e.AsgardeoAuthClient=Er,e.CLIENT_ID_TAG=g,e.CLIENT_SECRET_TAG=v,e.OIDC_SCOPE=S,e.PKCE_CODE_VERIFIER=m,e.REFRESH_TOKEN_TIMER="refresh_token_timer",e.SCOPE_TAG=p,e.SESSION_STATE=w,e.SIGN_OUT_SUCCESS_PARAM=_,e.SIGN_OUT_URL="sign_out_url",e.TOKEN_TAG=f,e.USERNAME_TAG=l,Object.defineProperty(e,"__esModule",{value:!0}),e}({});
//# sourceMappingURL=asgardeo-auth.production.min.js.map
